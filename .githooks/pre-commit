#!/bin/bash

#Get the staged .java files
stagedFiles=$(git diff --cached --name-only --diff-filter=ACM | grep '\.java$')

if [ -z "$stagedFiles" ]; then
    exit 0
fi

for file in $stagedFiles; do
    #Remove multiple empty lines using sed
    sed -i.bak '/^$/N;/^\n$/D' "$file"

    #Ensure file ends with a newline
    if [ -n "$(tail -c1 "$file")" ]; then
        echo "" >> "$file"
    fi

    rm "$file.bak"

    #Re-add the cleaned file to the commit
    git add "$file"
done

exit 0